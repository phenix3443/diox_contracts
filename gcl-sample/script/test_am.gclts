allocate.address 8
chain.gaslimit 12800000

chain.deploy @0 ../lib/utils/Utils.gcl
chain.deploy @0 ../lib/utils/SizeOf.gcl
chain.deploy @0 ../lib/utils/TypesToBytes.gcl
chain.deploy @0 ../lib/utils/BytesToTypes.gcl
chain.deploy @0 ../lib/utils/TLVUtils.gcl
chain.deploy @0 ../lib/am/AMLib.gcl

chain.deploy @0 ../interfaces/IAuthMessage.gcl
chain.deploy @0 ../interfaces/ISubProtocol.gcl
chain.deploy @0 ../AuthMsg.gcl={_owner:"$@0$", _relayer:"$@1$"}

log.highlight "Test AuthMsg contract"

log "Test 1: setProtocolWithID"
AuthMsg.setProtocolWithID #g {protocolID:81610670081, protocolAddress:"0x0000001300600001:contract", protocolType:1}

log "Test 2: recvFromProtocol (需要从已注册的协议地址调用)"
// 注意：recvFromProtocol 需要从已注册的协议合约地址调用
// 这里先部署一个简单的协议合约来测试
// 由于需要实现 ISubProtocol 接口，暂时跳过此测试
// AuthMsg.recvFromProtocol #g {senderID:"0x0000001300600001:contract", message:[255, 255, 255, 255, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32]}

log "AuthMsg test done"

chain.run